---
title: "Nitrogen Fertilizer Balance Analysis"
format: html
---

```{r setup, include=FALSE}
library(dplyr)
library(knitr)
library(kableExtra)
```


## Summary

This notebook demonstrates how to analyze the application of N2 fertilizer to a crop vis-a-vie how much is actually needed.

It is based on the mass-balance model:

$$N_{surplus} = N_{applied} - (Yield_{target} \times U_{efficiency})$$

Where:

* $N_{surplus}$: Potential nitrogen remaining in soil (lbs/acre).
* $N_{applied}$: User-defined fertilizer application rate (lbs/acre).
* $Yield_{target}$: The expected harvest yield (e.g., tons/acre).
* $U_{efficiency}$: The nitrogen uptake coefficient (lbs of N per unit of yield).

To apply this model, we will substitute:

i) the expected amount of N2 applied  
ii) the expected yield of the crop when harvested, and   
iii) the N2 uptake efficiency (i.e., the amount of N2 removed by the harvest)

Goal:

The management goal is for the difference between what is needed and what is replenished to be close to zero.



## N2 Uptake Efficiency 

N2 updake efficiency varies by crop:

```{r}
crop_tbl <- tibble(
  crop = c("Almonds", "Processing Tomatoes", "Lettuce"),
  units = c("lbs meat", "tons", "tons"),
  coeff = c(0.068, 2.5, 3.0)
)

crop_tbl |> kable()
```

## Example

Define inputs:

```{r}
library(dplyr)

crop_name <- "Lettuce"
n2_applied = 150          ## lbs/acre
yield_target <- 25       ## tons/acre
n2_cost_lb <- 0.85       ## Cost of N2 in $/lb
```

Look up the uptake efficiency:

```{r}
uptake_efficiency <- crop_tbl |> 
  filter(crop == crop_name) |> 
  pull(coeff)

uptake_efficiency
```

\

Perform the calculation of 'surplus' N2 (lbs/acre):

```{r}
n2_surplus <- n2_applied - (yield_target * uptake_efficiency)

n2_surplus
```

What the surplus is costing me in $ per acre:

```{r}
n2_surplus * n2_cost_lb
```



